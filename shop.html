<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åº—èˆ—ã‚¢ãƒ—ãƒª (PosiPay)</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet">
    <script type="text/javascript" src="qrcode.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jsqr@1.4.0/dist/jsQR.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-database-compat.js"></script>
    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyC8WKf1uoTOn8-HGPwu_GHJ_2MZpmaco10",
            authDomain: "my-paypay-sim-45735.firebaseapp.com",
            databaseURL: "https://my-paypay-sim-45735-default-rtdb.firebaseio.com/",
            projectId: "my-paypay-sim-45735",
            storageBucket: "my-paypay-sim-45735.firebasestorage.app",
            messagingSenderId: "310980051016",
            appId: "1:310980051016:web:38083c1005b783054b587d"
        };
        firebase.initializeApp(firebaseConfig);
        database = firebase.database(); 
    </script>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1 class="app-title">åº—èˆ—ã‚¢ãƒ—ãƒª</h1>
            <p class="shop-name">PosiPay</p>
        </header>

        <div id="mainShopSection" class="card">
            <h2 class="section-title">æ”¯æ‰•ã„é‡‘é¡è¨­å®š</h2>
            <div class="input-group">
                <label for="paymentAmount">é‡‘é¡:</label>
                <input type="number" id="paymentAmount" placeholder="æ”¯æ‰•ã„é‡‘é¡ã‚’å…¥åŠ›" min="0" max="1000000">
            </div>
            <button id="generateQrBtn" class="primary-btn">
                <span class="icon">ğŸ”—</span> QRã‚³ãƒ¼ãƒ‰ã‚’è¡¨ç¤º
            </button>
            <div style="margin-top: 30px; border-top: 1px dashed #ccc; padding-top: 20px;">
                <p style="font-size:0.9em; margin-bottom:10px;">ãŠå®¢æ§˜ã¸é€é‡‘ï¼ˆè¿”é‡‘ãªã©ï¼‰</p>
                <button id="startRemittanceBtn" class="secondary-btn" style="background-color:#ff9800; color:white;">
                    <span class="icon">ğŸ’¸</span> é€é‡‘ã™ã‚‹ (QRèª­å–)
                </button>
            </div>
        </div>

        <div id="qrDisplaySection" class="section hidden card">
            <h2 class="section-title">ãŠæ”¯æ‰•ã„QRã‚³ãƒ¼ãƒ‰</h2>
            <div class="qr-display-section">
                <div id="qrCodeCanvas" class="qr-code-display"></div> 
                <p class="qr-info">ãŠå®¢æ§˜ã®ã‚¢ãƒ—ãƒªã§èª­ã¿å–ã£ã¦ãã ã•ã„</p>
            </div>
             <p class="payment-status-message" id="paymentStatusMessage" style="margin-top:15px; font-weight: bold; color: #007bff;">
                â³ é¡§å®¢ã‹ã‚‰ã®æ”¯æ‰•ã„å¾…ã¡...
            </p>
            <button id="resetAppBtn" class="secondary-btn" style="margin-top: 20px;">
                <span class="icon">ğŸ”„</span> ã‚­ãƒ£ãƒ³ã‚»ãƒ«
            </button>
        </div>

        <div id="shopScannerSection" class="section hidden card">
            <h2 class="section-title">é€é‡‘å…ˆQRèª­å–</h2>
            <div class="camera-container">
                <video id="shopCameraVideo" playsinline></video>
                <canvas id="shopQrCanvas" hidden></canvas>
            </div>
            <p style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis; text-align: center; margin: 10px 0; font-size: 14px; font-weight: bold;">
                ãŠå®¢æ§˜ã®ã€Œå—ã‘å–ã‚ŠQRã€ã‚’æ˜ ã—ã¦ãã ã•ã„
            </p>
            <button id="cancelRemittanceBtn" class="secondary-btn">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
        </div>

        <div id="remittanceAmountSection" class="section hidden card">
            <h2 class="section-title">é€é‡‘é‡‘é¡å…¥åŠ›</h2>
            <p>é€é‡‘å…ˆID: <span id="targetUserIdDisplay" style="font-weight:bold;"></span></p>
            <div class="input-group">
                <input type="number" id="remittanceAmountInput" max="1000000" placeholder="é‡‘é¡ã‚’å…¥åŠ›">
            </div>
            <button id="confirmRemittanceBtn" class="primary-btn">é€é‡‘å®Ÿè¡Œ</button>
            <button id="backToScanBtn" class="secondary-btn" style="margin-top:10px;">æˆ»ã‚‹</button>
        </div>

        <div class="payment-received-section hidden" id="paymentReceivedSection">
            <div class="completion-card card">
                <div class="completion-icon" style="background-color:#28a745; color:white; width:80px; height:80px; border-radius:50%; display:flex; justify-content:center; align-items:center; margin:0 auto 20px; font-size:40px;">âœ…</div>
                <p class="completion-message">å…¥é‡‘ãŒå®Œäº†ã—ã¾ã—ãŸï¼</p>
                <p class="received-amount" id="receivedAmount" style="font-size:2em; font-weight:bold;">Â¥ 0</p>
                <p class="received-customer-info" id="receivedCustomerInfo" style="color:#666;"></p>
                <p style="color:#888; font-size:12px;">2ç§’å¾Œã«æ¬¡ã®æ”¯æ‰•ã„å¾…æ©Ÿã«æˆ»ã‚Šã¾ã™</p>
            </div>
            <button id="backToMainFromShopCompletionBtn" class="primary-btn">ãƒ¡ã‚¤ãƒ³ç”»é¢ã«æˆ»ã‚‹</button>
        </div>

        <div id="remittanceCompletionSection" class="section hidden card">
            <div class="completion-card card" style="box-shadow:none; padding:0;">
                <div class="completion-icon" style="background-color: #ff9800; color: white; display: flex; justify-content: center; align-items: center; width: 80px; height: 80px; border-radius: 50%; margin: 0 auto 20px; font-size: 40px;">ğŸ’¸</div>
                <p class="completion-message">é€é‡‘ãŒå®Œäº†ã—ã¾ã—ãŸï¼</p>
                <p id="sentAmountDisplay" style="font-size: 2.5em; font-weight: bold; color: #333; margin: 10px 0;">Â¥ 0</p>
                <p id="sentToUserDisplay" style="color: #666; font-size: 14px; margin-bottom: 20px;"></p>
                <p style="color: #888; font-size: 12px; margin-bottom: 15px;">3ç§’å¾Œã«è‡ªå‹•çš„ã«ãƒ¡ã‚¤ãƒ³ç”»é¢ã«æˆ»ã‚Šã¾ã™</p>
            </div>
            <button id="backToMainFromRemittanceBtn" class="primary-btn">ãƒ¡ã‚¤ãƒ³ç”»é¢ã«æˆ»ã‚‹</button>
        </div>

        <div class="history-section card">
            <h2 class="section-title">æ”¯æ‰•ã„å®Œäº†å±¥æ­´</h2>
            <ul id="shopTransactionHistory" style="padding:0;"></ul>
        </div>
    </div>
    <script src="shop_script.js"></script>
</body>
</html>
