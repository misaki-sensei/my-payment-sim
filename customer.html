<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é¡§å®¢ã‚¢ãƒ—ãƒª (æ¨¡æ“¬PayPay)</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet">
    
    <!-- Firebase SDKã®èª­ã¿è¾¼ã¿ -->
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-database.js"></script>
    
    <script>
        // ã‚ãªãŸã®Firebaseãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®è¨­å®šæƒ…å ±
        const firebaseConfig = {
            apiKey: "AIzaSyC8WKf1uoTOn8-HGPwu_GHJ_2MZpmaco10",
            authDomain: "my-paypay-sim-45735.firebaseapp.com",
            databaseURL: "https://my-paypay-sim-45735-default-rtdb.firebaseio.com/", // **å¤‰æ›´ç‚¹:** Firebaseã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§ç¢ºèªã—ãŸURLã«æ›´æ–°
            projectId: "my-paypay-sim-45735",
            storageBucket: "my-paypay-sim-45735.firebasestorage.app",
            messagingSenderId: "310980051016",
            appId: "1:310980051016:web:38083c1005b783054b587d"
        };
        // Firebaseã‚’åˆæœŸåŒ–
        firebase.initializeApp(firebaseConfig);
        // Realtime Databaseã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’å–å¾—
        // **å¤‰æ›´ç‚¹:** constã‚’å‰Šé™¤ã—ã€databaseã‚’ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã¨ã—ã¦å®šç¾©
        database = firebase.database(); 
    </script>
</head>
<body>
    
    <div class="container app-container" id="appContainer">
        <div class="header">
            <h1 class="app-title">é¡§å®¢ã‚¢ãƒ—ãƒª</h1>
        </div>

        <div class="balance-section card">
            <p class="balance-label">ç¾åœ¨ã®æ®‹é«˜</p>
            <p class="balance" id="currentBalance">Â¥ 0</p>
        </div>

        <div class="main-payment-section" id="mainPaymentSection">
            <p class="section-description">åº—èˆ—ã®QRã‚³ãƒ¼ãƒ‰ã‚’èª­ã¿å–ã£ã¦æ±ºæ¸ˆã—ã¾ã™</p>
            <button id="showQrReaderBtn" class="action-btn qr-toggle-btn large-btn">
                <span class="icon">ğŸ“·</span> åº—èˆ—QRã‚³ãƒ¼ãƒ‰ã‚’èª­ã¿å–ã‚‹
            </button>
            <button id="showChargeBtn" class="action-btn charge-toggle-btn large-btn">
                <span class="icon">â•</span> ãƒãƒ£ãƒ¼ã‚¸ã™ã‚‹
            </button>
        </div>

        <div class="qr-reader-section hidden" id="qrReaderSection">
            <h2 class="section-title-small">QRã‚³ãƒ¼ãƒ‰èª­ã¿å–ã‚Š</h2>
            <div class="qr-camera-feed">
                <video id="qrCameraVideo" class="camera-preview" playsinline></video>
                <!-- **å¤‰æ›´ç‚¹:** qrCanvasã¯hiddenå±æ€§ã‚’åˆæœŸçŠ¶æ…‹ã§ã¯æŒãŸãªã„ã‚ˆã†ã«å¤‰æ›´ã€‚JSã§åˆ¶å¾¡ -->
                <canvas id="qrCanvas"></canvas> 
            </div>
            <p id="cameraStatus" class="status-message"></p>
            <p class="scanned-amount-display" id="readAmountDisplay">
                èª­ã¿å–ã‚Šé‡‘é¡: <span id="scannedAmount">Â¥ 0</span>
            </p>
            <button id="confirmPayBtn" class="primary-btn action-btn" disabled>
                <span class="icon">âœ…</span> æ”¯æ‰•ã†
            </button>
            <button id="cancelQrReadBtn" class="secondary-btn toggle-btn">
                <span class="icon">âŒ</span> ã‚­ãƒ£ãƒ³ã‚»ãƒ«
            </button>
        </div>

        <div class="charge-section hidden" id="chargeSection">
            <h2 class="section-title">ãƒãƒ£ãƒ¼ã‚¸</h2>
            <div class="input-group">
                <label for="chargeAmountInput">ãƒãƒ£ãƒ¼ã‚¸é‡‘é¡:</label>
                <input type="number" id="chargeAmountInput" placeholder="ãƒãƒ£ãƒ¼ã‚¸é‡‘é¡ã‚’å…¥åŠ›" min="1" value="1000">
            </div>
            <!-- **å¤‰æ›´ç‚¹:** predicted-balanceã‚’è¡¨ç¤ºã™ã‚‹pã‚¿ã‚°ã«idã‚’è¿½åŠ  -->
            <p class="predicted-balance" id="predictedBalanceContainer"> 
                ãƒãƒ£ãƒ¼ã‚¸å¾Œæ®‹é«˜: <span id="predictedBalanceDisplay">Â¥ 0</span>
            </p>
            <button id="confirmChargeBtn" class="primary-btn action-btn">
                <span class="icon">â•</span> ãƒãƒ£ãƒ¼ã‚¸ã‚’å®Ÿè¡Œ
            </button>
            <button id="cancelChargeBtn" class="secondary-btn toggle-btn">
                <span class="icon">âŒ</span> ã‚­ãƒ£ãƒ³ã‚»ãƒ«
            </button>
        </div>

        <div class="payment-completion-section hidden" id="paymentCompletionSection">
            <div class="completion-card card">
                <div class="completion-icon" role="img" aria-label="æ±ºæ¸ˆå®Œäº†">âœ…</div>
                <p class="completion-message">æ±ºæ¸ˆãŒå®Œäº†ã—ã¾ã—ãŸï¼</p>
                <p class="completed-amount" id="completedAmount">Â¥ 0</p>
                <p class="thanks-message">ã”åˆ©ç”¨ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ã€‚</p>
                <p class="shop-id-display" id="completedShopId"></p>
            </div>
            <button id="backToMainFromCompletionBtn" class="primary-btn toggle-btn">ãƒ¡ã‚¤ãƒ³ç”»é¢ã«æˆ»ã‚‹</button>
        </div>

        <div class="charge-completion-section hidden" id="chargeCompletionSection">
            <div class="completion-card card">
                <div class="completion-icon" role="img" aria-label="ãƒãƒ£ãƒ¼ã‚¸å®Œäº†">â•</div>
                <p class="completion-message">ãƒãƒ£ãƒ¼ã‚¸ãŒå®Œäº†ã—ã¾ã—ãŸï¼</p>
                <p class="completed-amount" id="chargedAmount">Â¥ 0</p>
                <p class="thanks-message">ã”åˆ©ç”¨ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ã€‚</p>
            </div>
            <button id="backToMainFromChargeCompletionBtn" class="primary-btn toggle-btn">ãƒ¡ã‚¤ãƒ³ç”»é¢ã«æˆ»ã‚‹</button>
        </div>

        <div class="history-section card">
            <h2 class="section-title">æ”¯æ‰•ã„å®Œäº†å±¥æ­´</h2> 
            <ul id="transactionHistory"></ul>
        </div>
    </div>

    <!-- jsqr.min.js ã¯ customer_script.js ã‚ˆã‚Šå‰ã«èª­ã¿è¾¼ã‚€å¿…è¦ãŒã‚ã‚Šã¾ã™ -->
    <script src="jsqr.min.js"></script>
    <script src="customer_script.js"></script>
</body>
</html>
