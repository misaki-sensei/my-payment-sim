<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãŠå®¢ã‚¢ãƒ—ãƒª (PosiPay)</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet">
    
    <script type="text/javascript" src="qrcode.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jsqr@1.4.0/dist/jsQR.js"></script>
    
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-database-compat.js"></script>
    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyC8WKf1uoTOn8-HGPwu_GHJ_2MZpmaco10",
            authDomain: "my-paypay-sim-45735.firebaseapp.com",
            databaseURL: "https://my-paypay-sim-45735-default-rtdb.firebaseio.com/",
            projectId: "my-paypay-sim-45735",
            storageBucket: "my-paypay-sim-45735.firebasestorage.app",
            messagingSenderId: "367984856012",
            appId: "1:367984856012:web:15842c3855502758b90709"
        };
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
    </script>
    <script src="customer_script.js" defer></script>
</head>
<body>
    <div class="container" id="appContainer">
        <header class="header">
            <h1 class="app-title">PosiPay</h1>
            <p class="shop-name">ãŠå®¢ã•ã¾ç”¨ã‚¢ãƒ—ãƒª</p>
        </header>

        <div id="mainPaymentSection" class="section">
            <div class="balance-section card">
                <p class="balance-label">æ®‹é«˜</p>
                <p class="balance">Â¥ <span id="currentBalance">0</span></p>
            </div>

            <div class="action-section">
                <div class="buttons">
                    <button id="showQrReaderBtn" class="action-btn pay-btn">
                        <span class="icon">ğŸ“·</span> æ”¯æ‰•ã†
                    </button>
                    <button id="showChargeBtn" class="action-btn charge-toggle-btn">
                        <span class="icon">Â¥</span> ãƒãƒ£ãƒ¼ã‚¸
                    </button>
                    <button id="showReceiveBtn" class="action-btn toggle-btn">
                        <span class="icon">ğŸ“¥</span> å—ã‘å–ã‚‹
                    </button>
                </div>
            </div>
        </div>

        <div id="qrReaderSection" class="section hidden card">
            <h2 class="section-title">QRã‚³ãƒ¼ãƒ‰ã‚’èª­ã¿å–ã‚‹</h2>
            <div class="qr-camera-area">
                <video id="qrCameraVideo" class="qr-camera-video" playsinline="true"></video>
                <canvas id="qrCanvas"></canvas>
                <div class="camera-status" id="cameraStatus">ã‚«ãƒ¡ãƒ©èµ·å‹•ä¸­...</div>
                <div class="scan-line"></div>
            </div>
            <p class="qr-instruction">åº—èˆ—ã®QRã‚³ãƒ¼ãƒ‰ã‚’æ å†…ã«æ˜ ã—ã¦ãã ã•ã„</p>
            
            <div id="readAmountDisplay" class="read-amount-display hidden">
                èª­ã¿å–ã‚Šé‡‘é¡: <span id="scannedAmount">0</span> å††
            </div>

            <button id="confirmPayBtn" class="primary-btn hidden" style="margin-top:10px;">æ”¯æ‰•ã†</button>
            <button id="cancelQrReadBtn" class="secondary-btn" style="margin-top:10px;">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
        </div>

        <div id="receiveQrSection" class="section hidden card">
            <h2 class="section-title">ãŠé‡‘ã‚’å—ã‘å–ã‚‹</h2>
            <div class="qr-display-container">
                <div id="receiveQrCode" class="qr-code-placeholder"></div>
                <p class="instruction-text">ãŠåº—ã®äººã«èª­ã¿å–ã£ã¦ã‚‚ã‚‰ã£ã¦ãã ã•ã„</p>
            </div>
            <button id="closeReceiveBtn" class="secondary-btn">æˆ»ã‚‹</button>
        </div>

        <div id="chargeSection" class="section hidden card">
            <h2 class="section-title">æ®‹é«˜ãƒãƒ£ãƒ¼ã‚¸</h2>
            <div class="input-group">
                <label>ãƒãƒ£ãƒ¼ã‚¸é‡‘é¡</label>
                <input type="number" id="chargeAmountInput" placeholder="1000" inputmode="numeric">
            </div>
            <div class="predicted-balance-display">
                ãƒãƒ£ãƒ¼ã‚¸å¾Œæ®‹é«˜: Â¥ <span id="predictedBalance">0</span>
            </div>
            <button id="confirmChargeBtn" class="primary-btn">ãƒãƒ£ãƒ¼ã‚¸ã™ã‚‹</button>
            <button id="cancelChargeBtn" class="secondary-btn" style="margin-top:10px;">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
        </div>

        <div class="payment-completion-section hidden" id="paymentCompletionSection">
            <div class="completion-card card">
                <div class="completion-icon" role="img" aria-label="æ±ºæ¸ˆå®Œäº†">âœ…</div>
                <p class="completion-message">æ±ºæ¸ˆãŒå®Œäº†ã—ã¾ã—ãŸï¼</p>
                <p class="completed-amount" id="completedAmount">Â¥ 0</p>
                <p class="thanks-message">ã”åˆ©ç”¨ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ã€‚</p>
                <p class="shop-id-display" id="completedShopId"></p>
            </div>
            <button id="backToMainFromCompletionBtn" class="primary-btn toggle-btn">ãƒ¡ã‚¤ãƒ³ç”»é¢ã«æˆ»ã‚‹</button>
        </div>

        <div class="charge-completion-section hidden" id="chargeCompletionSection">
            <div class="completion-card card">
                <div class="completion-icon" role="img" aria-label="ãƒãƒ£ãƒ¼ã‚¸å®Œäº†">â•</div>
                <p class="completion-message">ãƒãƒ£ãƒ¼ã‚¸ãŒå®Œäº†ã—ã¾ã—ãŸï¼</p>
                <p class="completed-amount" id="chargedAmount">Â¥ 0</p>
                <p class="thanks-message">ã”åˆ©ç”¨ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ã€‚</p>
            </div>
            <button id="backToMainFromChargeCompletionBtn" class="primary-btn toggle-btn">ãƒ¡ã‚¤ãƒ³ç”»é¢ã«æˆ»ã‚‹</button>
        </div>

        <div class="history-section card">
            <h2 class="section-title">å–å¼•å±¥æ­´</h2>
            <ul id="transactionHistory"></ul>
        </div>
    </div>
</body>
</html>
