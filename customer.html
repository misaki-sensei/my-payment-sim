<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãŠå®¢ã‚¢ãƒ—ãƒª (PosiPay)</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet">
    
    <script type="text/javascript" src="qrcode.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jsqr@1.4.0/dist/jsQR.js"></script>
    
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-database-compat.js"></script>
    <script>
        // Firebaseè¨­å®šï¼ˆä¸€ç•ªæœ€åˆã®ã‚‚ã®ï¼‰
        const firebaseConfig = {
            apiKey: "AIzaSyC8WKf1uoTOn8-HGPwu_GHJ_2MZpmaco10",
            authDomain: "my-paypay-sim-45735.firebaseapp.com",
            databaseURL: "https://my-paypay-sim-45735-default-rtdb.firebaseio.com/",
            projectId: "my-paypay-sim-45735",
            storageBucket: "my-paypay-sim-45735.firebasestorage.app",
            messagingSenderId: "310980051016",
            appId: "1:310980051016:web:38083c1005b783054b587d"
        };
        firebase.initializeApp(firebaseConfig);
        window.database = firebase.database(); 
    </script>
</head>
<body>

    <div class="container app-container">
        <div class="header">
            <h1 class="app-title">ãŠå®¢ã‚¢ãƒ—ãƒª</h1>
        </div>

        <div class="balance-section card">
            <p class="balance-label">ç¾åœ¨ã®æ®‹é«˜</p>
            <p class="balance" id="currentBalance">Â¥ 0</p>
        </div>

        <div id="mainPaymentSection">
            <button id="showQrReaderBtn" class="action-btn primary-btn large-btn">
                <span class="icon">ğŸ“¸</span> åº—èˆ—QRã‚³ãƒ¼ãƒ‰ã‚’èª­ã¿å–ã‚‹
            </button>
            <button id="showChargeBtn" class="action-btn charge-toggle-btn large-btn">
                <span class="icon">â•</span> ãƒãƒ£ãƒ¼ã‚¸ã™ã‚‹
            </button>
            <button id="showReceiveBtn" class="action-btn toggle-btn large-btn" style="margin-top: 15px;">
                <span class="icon">ğŸ“¥</span> ãŠé‡‘ã‚’å—ã‘å–ã‚‹
            </button>
        </div>

        <div id="qrReaderSection" class="hidden section card">
            <h2 class="section-title">QRã‚³ãƒ¼ãƒ‰èª­ã¿å–ã‚Š</h2>
            <video id="qrCameraVideo" autoplay playsinline muted style="width: 100%; border-radius: 8px;"></video>
            <canvas id="qrCanvas" style="display:none;"></canvas>
            
            <div id="readAmountDisplay" class="hidden" style="text-align:center; margin-top:15px;">
                <p>æ”¯æ‰•é‡‘é¡</p>
                <p id="scannedAmount" class="completed-amount">Â¥ 0</p>
            </div>

            <button id="confirmPayBtn" class="action-btn pay-btn hidden" style="margin-top: 15px;">æ”¯æ‰•ã„ã‚’ç¢ºå®šã™ã‚‹</button>
            <button id="cancelQrReadBtn" class="secondary-btn" style="margin-top: 15px;">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
        </div>

        <div id="chargeSection" class="hidden section card">
            <h2 class="section-title">æ®‹é«˜ãƒãƒ£ãƒ¼ã‚¸</h2>
            <input type="number" id="chargeAmountInput" placeholder="é‡‘é¡ã‚’å…¥åŠ›" inputmode="numeric" style="width: 100%; padding: 12px; font-size: 18px;">
            <p style="margin-top: 10px;">ãƒãƒ£ãƒ¼ã‚¸å¾Œã®æ®‹é«˜: Â¥ <span id="predictedBalance">0</span></p>
            <button id="confirmChargeBtn" class="action-btn charge-toggle-btn">ãƒãƒ£ãƒ¼ã‚¸å®Ÿè¡Œ</button>
            <button id="cancelChargeBtn" class="secondary-btn" style="margin-top: 15px;">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
        </div>

        <div id="paymentCompletionSection" class="hidden section card">
            <div class="completion-icon">âœ…</div>
            <p class="completion-message">æ±ºæ¸ˆå®Œäº†</p>
            <p id="completedAmount" class="completed-amount">Â¥ 0</p>
            <button id="backToMainFromCompletionBtn" class="primary-btn toggle-btn">ãƒ¡ã‚¤ãƒ³ç”»é¢ã«æˆ»ã‚‹</button>
        </div>

        <div id="chargeCompletionSection" class="hidden section card">
            <div class="completion-icon" style="background-color: #4caf50;">âš¡</div>
            <p class="completion-message">ãƒãƒ£ãƒ¼ã‚¸ãŒå®Œäº†ã—ã¾ã—ãŸ</p>
            <p id="chargedAmount" class="completed-amount">Â¥ 0</p>
            <button id="backToMainFromChargeCompletionBtn" class="secondary-btn">é–‰ã˜ã‚‹</button>
        </div>

        <div id="receiveQrSection" class="hidden section card">
            <h2 class="section-title">å—å–ç”¨QRã‚³ãƒ¼ãƒ‰</h2>
            <div id="receiveQrCode" style="display: flex; justify-content: center; margin: 20px 0;"></div>
            <p style="text-align: center; color: #666;">ãŠåº—ã«èª­ã¿å–ã£ã¦ã‚‚ã‚‰ã£ã¦ãã ã•ã„</p>
            <button id="closeReceiveBtn" class="secondary-btn large-btn">æˆ»ã‚‹</button>
        </div>

        <div id="receiveCompletionSection" class="hidden section card">
            <div class="completion-icon" style="background-color: #ff9800;">ğŸ’°</div>
            <p class="completion-message">ãŠé‡‘ã‚’å—ã‘å–ã‚Šã¾ã—ãŸï¼</p>
            <p id="receivedAmountDisplay" class="completed-amount">Â¥ 0</p>
            <button id="backToMainFromReceiveBtn" class="secondary-btn">é–‰ã˜ã‚‹</button>
        </div>

        <div class="history-section card">
            <h2 class="section-title">å±¥æ­´</h2>
            <ul id="transactionHistory"></ul>
        </div>
    </div>

    <script src="customer_script.js"></script>
</body>
</html>
