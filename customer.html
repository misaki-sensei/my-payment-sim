<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãŠå®¢ã‚¢ãƒ—ãƒª (PosiPay)</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet">
    
    <script type="text/javascript" src="qrcode.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jsqr@1.4.0/dist/jsQR.js"></script>
    
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-database-compat.js"></script>
    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyC8WKf1uoTOn8-HGPwu_GHJ_2MZpmaco10",
            authDomain: "my-paypay-sim-45735.firebaseapp.com",
            databaseURL: "https://my-paypay-sim-45735-default-rtdb.firebaseio.com/",
            projectId: "my-paypay-sim-45735",
            storageBucket: "my-paypay-sim-45735.appspot.com",
            messagingSenderId: "365315357989",
            appId: "1:365315357989:web:80800778c78c18ec52366b"
        };
        firebase.initializeApp(firebaseConfig);
        window.database = firebase.database();
    </script>
</head>
<body>
    <div class="container">
        <div id="mainPaymentSection" class="section">
            <div class="header">
                <h1 class="app-title">PosiPay</h1>
                <p id="myIdDisplay" style="font-size: 0.8em; color: #666; margin: 5px 0;"></p>
            </div>

            <div class="card balance-section">
                <p class="balance-label">æ®‹é«˜</p>
                <p class="balance" id="currentBalance">Â¥ 0</p>
            </div>

            <button id="showQrReaderBtn" class="action-btn pay-btn large-btn">
                <span class="icon">ğŸ“·</span> QRã‚³ãƒ¼ãƒ‰ã‚’èª­ã¿å–ã‚‹
            </button>
            
            <button id="showReceiveBtn" class="action-btn toggle-btn large-btn" style="margin-top:10px;">
                <span class="icon">ğŸ’°</span> ãŠé‡‘ã‚’å—ã‘å–ã‚‹
            </button>

            <button id="showChargeBtn" class="action-btn charge-toggle-btn large-btn">
                <span class="icon">â•</span> ãƒãƒ£ãƒ¼ã‚¸ã™ã‚‹
            </button>
        </div>

        <div id="qrReaderSection" class="section hidden">
            <h2 class="section-title">QRã‚¹ã‚­ãƒ£ãƒ³</h2>
            <div class="qr-camera-area">
                <video id="qrCameraVideo" class="qr-camera-video" playsinline></video>
                <canvas id="qrCanvas"></canvas>
                <div id="cameraStatus" class="camera-status">ã‚«ãƒ¡ãƒ©èµ·å‹•ä¸­...</div>
                <div class="scan-line"></div>
            </div>
            <div id="readAmountDisplay" class="read-amount-display hidden">
                æ”¯æ‰•é¡: <span id="scannedAmount">Â¥ 0</span>
            </div>
            <div class="buttons">
                <button id="confirmPayBtn" class="primary-btn hidden">æ”¯æ‰•ã„ã‚’ç¢ºå®šã™ã‚‹</button>
                <button id="cancelQrReadBtn" class="secondary-btn">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
            </div>
        </div>

        <div id="receiveQrSection" class="section hidden">
            <h2 class="section-title">å—ã‘å–ã‚Š</h2>
            <p class="instruction-text">ç›¸æ‰‹ã«ã“ã®QRã‚’èª­ã¿å–ã£ã¦ã‚‚ã‚‰ã£ã¦ãã ã•ã„</p>
            <div class="qr-display-container">
                <div id="receiveQrCode"></div>
            </div>
            <button id="closeReceiveBtn" class="secondary-btn">é–‰ã˜ã‚‹</button>
        </div>

        <div id="chargeSection" class="section hidden">
            <h2 class="section-title">ãƒãƒ£ãƒ¼ã‚¸</h2>
            <div class="input-group">
                <label>ãƒãƒ£ãƒ¼ã‚¸é‡‘é¡</label>
                <input type="number" id="chargeAmountInput" placeholder="é‡‘é¡ã‚’å…¥åŠ›" inputmode="numeric">
            </div>
            <div id="predictedBalanceDisplay" class="predicted-balance-display">
                ãƒãƒ£ãƒ¼ã‚¸å¾Œæ®‹é«˜: <span id="newBalanceText">Â¥ 0</span>
            </div>
            <div class="buttons">
                <button id="confirmChargeBtn" class="primary-btn">ãƒãƒ£ãƒ¼ã‚¸å®Ÿè¡Œ</button>
                <button id="cancelChargeBtn" class="secondary-btn">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
            </div>
        </div>

        <div id="paymentCompletionSection" class="section hidden">
            <div class="completion-card card">
                <div class="completion-icon">âœ”</div>
                <p class="completion-message">æ”¯æ‰•ã„å®Œäº†</p>
                <p class="completed-amount" id="completedAmount">Â¥ 0</p>
                <p class="shop-id-display" id="completedShopId"></p>
            </div>
            <button id="backToMainFromCompletionBtn" class="primary-btn">ãƒ¡ã‚¤ãƒ³ã«æˆ»ã‚‹</button>
        </div>

        <div class="charge-completion-section hidden" id="chargeCompletionSection">
            <div class="completion-card card">
                <div class="completion-icon">â•</div>
                <p class="completion-message">ãƒãƒ£ãƒ¼ã‚¸å®Œäº†</p>
                <p class="completed-amount" id="chargedAmount">Â¥ 0</p>
            </div>
            <button id="backToMainFromChargeCompletionBtn" class="primary-btn">ãƒ¡ã‚¤ãƒ³ã«æˆ»ã‚‹</button>
        </div>

        <div class="receive-completion-section hidden" id="receiveCompletionSection">
            <div class="completion-card card">
                <div class="completion-icon" style="color: #ff9800;">ğŸ’°</div>
                <p class="completion-message">å—ã‘å–ã‚Šå®Œäº†</p>
                <p id="receivedAmountDisplay" class="completed-amount">Â¥ 0</p>
            </div>
            <button id="backToMainFromReceiveBtn" class="primary-btn">ãƒ¡ã‚¤ãƒ³ã«æˆ»ã‚‹</button>
        </div>

        <div class="history-section card">
            <h2 class="section-title">å±¥æ­´</h2>
            <ul id="transactionHistory"></ul>
        </div>
    </div>
    <script src="customer_script.js"></script>
</body>
</html>
